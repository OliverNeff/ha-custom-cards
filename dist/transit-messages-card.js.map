{"version":3,"file":"transit-messages-card.js","sources":["../src/transit-messages-card.ts"],"sourcesContent":["\r\n// src/transit-messages-card.ts\r\n// Transit Messages Card (TypeScript)\r\n// Autor: Oliver + Copilot (TS-Port)\r\n// Version: 1.0.1-ts\r\n\r\ntype Primitive = string | number | boolean | null | undefined;\r\n\r\nexport interface MessageEntry {\r\n  timestamp?: string | number | Date;\r\n  text?: Primitive;\r\n}\r\n\r\nexport interface Departure {\r\n  train?: string;\r\n  trainNumber?: string;\r\n  destination?: string;\r\n\r\n  scheduledDeparture?: string;  // \"HH:MM\" oder beliebig formatiert vom Sensor\r\n  departure_current?: string;   // \"—\" wenn unbekannt\r\n\r\n  scheduledPlatform?: string;\r\n  platform?: string;\r\n\r\n  delayDeparture?: number;      // Minuten\r\n\r\n  scheduledArrival?: string;\r\n  arrival_current?: string;\r\n\r\n  isCancelled?: number | boolean;\r\n\r\n  messages?: {\r\n    delay?: MessageEntry[];\r\n    qos?: MessageEntry[];\r\n  };\r\n\r\n  route?: Array<{ name?: string }>;\r\n}\r\n\r\nexport interface HassEntity {\r\n  entity_id?: string;\r\n  state: string;\r\n  attributes: Record<string, any>;\r\n  last_changed?: string;\r\n}\r\n\r\nexport interface HomeAssistant {\r\n  states: Record<string, HassEntity>;\r\n  // In HA gesetzt, hier optional fürs Mocking\r\n  callService?: (domain: string, service: string, data?: any) => void | Promise<void>;\r\n  formatEntityState?: (entity: HassEntity) => string;\r\n  locale?: { language?: string };\r\n}\r\n\r\ntype Mode = 'list' | 'selected';\r\n\r\nexport interface TransitMessagesCardConfig {\r\n  type: 'custom:transit-messages-card';\r\n  title?: string;\r\n  entity: string;\r\n  departures_attribute?: string;          // default: 'next_departures'\r\n  mode?: Mode;                            // 'list' | 'selected'\r\n  count?: number;                         // für 'list'\r\n  index_entity?: string | null;           // für 'selected'\r\n  show_qos?: boolean;\r\n  show_platform?: boolean;\r\n  show_arrival?: boolean;\r\n  compact?: boolean;\r\n  hide_when_empty?: boolean;\r\n  show_cancelled_section?: boolean;\r\n  include_cancelled_in_filter?: boolean;\r\n  contains?: string | null;               // EINZIGER Filter-String (case-insensitive) gegen Destination ODER Route\r\n}\r\n\r\ninterface ItemHtmlOptions {\r\n  cancelled: boolean;\r\n  compact: boolean;\r\n  show_platform: boolean;\r\n  show_qos: boolean;\r\n  show_arrival: boolean;\r\n}\r\n\r\nclass TransitMessagesCard extends HTMLElement {\r\n  static get version(): string { return '1.0.1'; }\r\n\r\n  private _hass?: HomeAssistant;\r\n  private _config?: TransitMessagesCardConfig;\r\n\r\n  constructor() {\r\n    super();\r\n    this.attachShadow({ mode: 'open' });\r\n  }\r\n\r\n  setConfig(config: TransitMessagesCardConfig): void {\r\n    if (!config || !config.entity) {\r\n      throw new Error(\"Konfiguration benötigt: 'entity' (z. B. sensor.<station>_departures)\");\r\n    }\r\n    this._config = {\r\n      // Defaults\r\n      title: 'Abfahrten',\r\n      departures_attribute: 'next_departures',\r\n      mode: 'list',\r\n      count: 5,\r\n      index_entity: null,\r\n      show_qos: true,\r\n      show_platform: true,\r\n      show_arrival: false,\r\n      compact: false,\r\n      hide_when_empty: false,\r\n      show_cancelled_section: true,\r\n      include_cancelled_in_filter: true,\r\n      contains: null,\r\n      // User-Config überschreibt Defaults\r\n      ...config,\r\n      type: 'custom:transit-messages-card',\r\n    };\r\n    // Erste Render-Möglichkeit\r\n    this._render();\r\n  }\r\n\r\n  set hass(hass: HomeAssistant | undefined) {\r\n    this._hass = hass;\r\n    this._render();\r\n  }\r\n\r\n  get hass(): HomeAssistant | undefined {\r\n    return this._hass;\r\n  }\r\n\r\n  getCardSize(): number { return 6; }\r\n\r\n  private _render(): void {\r\n    if (!this.shadowRoot || !this._config || !this._hass) return;\r\n\r\n    const {\r\n      entity,\r\n      title = 'Abfahrten',\r\n      departures_attribute = 'next_departures',\r\n      mode = 'list',\r\n      count = 5,\r\n      index_entity = null,\r\n      show_qos = true,\r\n      show_platform = true,\r\n      show_arrival = false,\r\n      compact = false,\r\n      hide_when_empty = false,\r\n      show_cancelled_section = true,\r\n      include_cancelled_in_filter = true,\r\n    } = this._config;\r\n\r\n    const style = `\r\n      ha-card { padding: 12px 14px; }\r\n      .header { font-weight: 600; font-size: 1.1rem; margin-bottom: 8px; }\r\n      .section-title { margin: 8px 0 4px 0; font-weight: 600; font-size: 1.0rem; }\r\n      .item { margin: 10px 0 14px 0; padding-bottom: 10px; border-bottom: 1px solid var(--divider-color, #e0e0e0); }\r\n      .row { display: flex; gap: 10px; flex-wrap: wrap; color: var(--secondary-text-color); font-size: 0.95rem; }\r\n      .small { font-size: 0.9rem; }\r\n      .muted { color: var(--disabled-text-color); font-style: italic; }\r\n      ul { margin: 6px 0 0 18px; padding: 0; }\r\n      .pill { background: var(--primary-background-color); border: 1px solid var(--divider-color); border-radius: 8px; padding: 2px 8px; font-size: 0.85rem; }\r\n      .pill.red { border-color: #b00020; color: #b00020; }\r\n      .pill.amber { border-color: #f9a825; color: #f9a825; }\r\n      .pill.green { border-color: #2e7d32; color: #2e7d32; }\r\n      .cancelled { border-left: 4px solid #b00020; padding-left: 8px; }\r\n    `;\r\n\r\n    const stateObj = this._hass.states[entity];\r\n    if (!stateObj) {\r\n      this.shadowRoot.innerHTML = `\r\n        <style>${style}</style>\r\n        <ha-card>\r\n          <div class=\"header\">${this._escape(title)}</div>\r\n          <div class=\"muted\">Entität '${this._escape(entity)}' nicht gefunden.</div>\r\n        </ha-card>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    const attr = stateObj.attributes ?? {};\r\n    const allRaw = Array.isArray(attr[departures_attribute]) ? (attr[departures_attribute] as Departure[]) : [];\r\n    const all: Departure[] = allRaw ?? [];\r\n\r\n    const filtered = all.filter((c) => this._matchesContains(c));\r\n    const notCancelled = filtered.filter((c) => !this._isCancelled(c));\r\n    const cancelledFiltered = filtered.filter((c) => this._isCancelled(c));\r\n    const cancelledAll = all.filter((c) => this._isCancelled(c));\r\n\r\n    // Welche Liste rendern?\r\n    let listToShow: Departure[] = [];\r\n    if (mode === 'selected') {\r\n      const idxStr = index_entity ? this._hass.states[index_entity]?.state : '0';\r\n      const idx = Number.parseInt(String(idxStr), 10);\r\n      const safeIdx = Number.isFinite(idx) && idx >= 0 ? idx : 0;\r\n      if (safeIdx < notCancelled.length) listToShow = [notCancelled[safeIdx]];\r\n    } else {\r\n      const n = Number.isFinite(count) ? (count as number) : 5;\r\n      listToShow = notCancelled.slice(0, n);\r\n    }\r\n\r\n    const itemsHtml = listToShow\r\n      .map((c) => this._connectionItemHtml(c, {\r\n        cancelled: false, compact, show_platform, show_qos, show_arrival\r\n      }))\r\n      .join('');\r\n\r\n    const cancelledSource = include_cancelled_in_filter ? cancelledFiltered : cancelledAll;\r\n    const cancelledHtml = (show_cancelled_section && cancelledSource.length)\r\n      ? `\r\n        <div class=\"section-title\">Stornierte Verbindungen</div>\r\n        ${cancelledSource\r\n          .slice(0, 20)\r\n          .map((c) => this._connectionItemHtml(c, {\r\n            cancelled: true, compact: true, show_platform, show_qos: false, show_arrival\r\n          }))\r\n          .join('')}\r\n      `\r\n      : '';\r\n\r\n    if (hide_when_empty && listToShow.length === 0 && cancelledSource.length === 0) {\r\n      this.style.display = 'none';\r\n      return;\r\n    } else {\r\n      this.style.display = '';\r\n    }\r\n\r\n    const suffix = this._formatContainsForTitle();\r\n    const composedTitle = `${title ?? 'Abfahrten'}${suffix}`;\r\n\r\n    const content = (listToShow.length || cancelledSource.length)\r\n      ? `${itemsHtml}${cancelledHtml}`\r\n      : `<div class=\"muted\">No data</div>`;\r\n\r\n    this.shadowRoot.innerHTML = `\r\n      <style>${style}</style>\r\n      <ha-card>\r\n        <div class=\"header\">${this._escape(composedTitle)}</div>\r\n        ${content}\r\n      </ha-card>\r\n    `;\r\n  }\r\n\r\n  private _connectionItemHtml(c: Departure, opts: ItemHtmlOptions): string {\r\n    const { cancelled, compact, show_platform, show_qos, show_arrival } = opts;\r\n\r\n    const train = c?.train ?? '';\r\n    const trainNumber = c?.trainNumber ?? '';\r\n    const dest = c?.destination ?? '';\r\n\r\n    const schedDep = c?.scheduledDeparture ?? '';\r\n    const depCur = c?.departure_current ?? '—';\r\n\r\n    const schedPlat = c?.scheduledPlatform ?? '';\r\n    const plat = c?.platform ?? schedPlat;\r\n\r\n    const delayDep = Number.isFinite(c?.delayDeparture) ? (c?.delayDeparture as number) : 0;\r\n\r\n    const delays: MessageEntry[] = Array.isArray(c?.messages?.delay) ? (c!.messages!.delay as MessageEntry[]) : [];\r\n    const qos: MessageEntry[] = Array.isArray(c?.messages?.qos) ? (c!.messages!.qos as MessageEntry[]) : [];\r\n\r\n    const arrSched = c?.scheduledArrival ?? '';\r\n    const arrCur = c?.arrival_current ?? '—';\r\n\r\n    const delayBadge = (() => {\r\n      if (!Number.isFinite(delayDep) || delayDep <= 0) return '';\r\n      const colorClass = delayDep >= 10 ? 'red' : delayDep >= 5 ? 'amber' : 'green';\r\n      return `<span class=\"pill ${colorClass}\">+${delayDep} min</span>`;\r\n    })();\r\n\r\n    const pills: string[] = [\r\n      `<span class=\"pill\">${this._escape(train)}</span>`,\r\n      `→ <strong>${this._escape(dest)}</strong>`\r\n    ];\r\n    if (show_platform && !!plat) pills.push(`<span class=\"pill\">Gleis ${this._escape(plat)}</span>`);\r\n    if (delayBadge) pills.push(delayBadge);\r\n    if (cancelled) pills.push(`<span class=\"pill red\">Storniert</span>`);\r\n\r\n    const headerLine = trainNumber\r\n      ? `<div class=\"small muted\">#<strong>${this._escape(trainNumber)}</strong></div>`\r\n      : '';\r\n\r\n    const timesHtml = `\r\n      <div class=\"small\" style=\"margin-top:4px;\">\r\n        Geplante Abfahrt: <strong>${this._escape(schedDep)}</strong>\r\n        ·\r\n        Aktuelle Abfahrt: <strong>${this._escape(depCur)}</strong>\r\n        ${show_arrival ? `\r\n          <br/>Geplante Ankunft: <strong>${this._escape(arrSched)}</strong>\r\n          ·\r\n          Aktuelle Ankunft: <strong>${this._escape(arrCur)}</strong>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n\r\n    let detailsHtml = '';\r\n    if (!compact && !cancelled) {\r\n      const delayLines = delays.length\r\n        ? `<div><strong>Verspätungs‑Meldungen:</strong></div>\r\n           <ul>${delays.map((m) => `<li>${this._fmtTime(m?.timestamp)} — ${this._escape(String(m?.text ?? ''))}</li>`).join('')}</ul>`\r\n        : `<div class=\"muted small\">(Keine Verspätungsmeldungen)</div>`;\r\n\r\n      const qosLines = (show_qos && qos.length)\r\n        ? `<div style=\"margin-top:6px;\"><strong>Qualitätsmeldungen:</strong></div>\r\n           <ul>${qos.map((q) => `<li>${this._fmtTime(q?.timestamp)} ${this._escape(String(q?.text ?? ''))}</li>`).join('')}</ul>`\r\n        : '';\r\n\r\n      detailsHtml = `<div style=\"margin-top:8px;\">${delayLines}${qosLines}</div>`;\r\n    }\r\n\r\n    const cancelledClass = cancelled ? ' cancelled' : '';\r\n    return `\r\n      <div class=\"item${cancelledClass}\">\r\n        ${headerLine}\r\n        <div class=\"row\">${pills.join(' ')}</div>\r\n        ${timesHtml}\r\n        ${detailsHtml}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  private _matchesContains(c: Departure): boolean {\r\n    const needle = (this._config?.contains ?? '').trim().toLowerCase();\r\n    if (!needle) return true;\r\n\r\n    const dest = String(c?.destination ?? '').toLowerCase();\r\n    const routeNames = Array.isArray(c?.route)\r\n      ? (c!.route!)\r\n          .map((r) => String(r?.name ?? ''))\r\n          .filter(Boolean)\r\n      : [];\r\n    const routeJoined = routeNames.join(' → ').toLowerCase();\r\n\r\n    return dest.includes(needle) || routeJoined.includes(needle);\r\n  }\r\n\r\n  private _formatContainsForTitle(): string {\r\n    const val = (this._config?.contains ?? '').trim();\r\n    return val ? ` (${this._escape(val)})` : '';\r\n  }\r\n\r\n  private _fmtTime(ts: unknown): string {\r\n    if (!ts) return '';\r\n    try {\r\n      const d = ts instanceof Date ? ts : new Date(ts as any);\r\n      if (isNaN(d.getTime())) return '';\r\n      return d.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\r\n    } catch {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  private _escape(s: unknown): string {\r\n    const str = String(s);\r\n    return str\r\n      .replace(/&/g, '&amp;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;')\r\n      .replace(/\"/g, '&quot;')\r\n      .replace(/'/g, '&#039;');\r\n  }\r\n\r\n  private _isCancelled(c: Departure | undefined): boolean {\r\n    const v = c?.isCancelled;\r\n    if (typeof v === 'boolean') return v;\r\n    if (typeof v === 'number') return v !== 0;\r\n    return false;\r\n    }\r\n\r\n  static getConfigElement(): HTMLElement | null {\r\n    // Separater Config-Editor ist optional – hier (wie im Original) keiner.\r\n    return null;\r\n  }\r\n}\r\n\r\n// Registrierung als Custom Element (so wie im Original)\r\nif (!customElements.get('transit-messages-card')) {\r\n  customElements.define('transit-messages-card', TransitMessagesCard);\r\n}\r\n\r\n// Export optional, damit Vite's lib build einen Namen hat\r\nexport { TransitMessagesCard };\r\n"],"names":[],"mappings":"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"}